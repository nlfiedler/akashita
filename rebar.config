%%
%% rebar3 configuration file
%%
{plugins, [
    {wivrr, {git, "https://github.com/nlfiedler/wivrr.git", {tag, "1.0.0"}}}
]}.

{minimum_otp_vsn, "17"}.

{erl_opts, [
    debug_info,
    fail_on_warning,
    {parse_transform, lager_transform}
]}.

{deps, [
    {lager,   {git, "https://github.com/basho/lager",       {tag, "3.2.1"}}},
    {inugami, {git, "https://github.com/nlfiedler/inugami", {tag, "1.0.0"}}}
]}.

{provider_hooks, [{pre, [{release, mkversion}]}]}.

{pre_hooks, [
    {compile, "bash -c 'go list google.golang.org/cloud > /dev/null || go get -u google.golang.org/cloud'"},
    {compile, "bash -c 'go list cloud.google.com/go > /dev/null || go get -u cloud.google.com/go'"},
    {compile, "go install github.com/nlfiedler/akashita"},
    {compile, "cp $GOPATH/bin/akashita priv"}
]}.
{post_hooks, [
    {clean, "go clean github.com/nlfiedler/akashita"}
]}.

{relx, [
    {include_erts, false},
    {include_src, false},
    {release, {akashita, "0.1.0"}, [
        akashita
    ]},
    {sys_config, "./config/sys.config"},
    {vm_args, "./config/vm.args"},
    {overlay, [
        % It would be great if there were overlay vars for all of the parts
        % in the path to the generated Version file, but there does not
        % seem to be any.
        {copy, "_build/default/lib/{{release_name}}/Version", "{{output_dir}}/Version"}
    ]}
]}.
